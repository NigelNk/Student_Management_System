{% include 'profiles/partials/_navbar_sidebar.html'%}
<!-- Content -->
<div id="layoutSidenav_content">
    <main>
        <div class="container-fluid px-4">
            <h1 class="mt-4 mb-4">
                Dashboard
            </h1>
            <!-- Cards Row -->
            <div class="row">
                <!-- Profile Card -->
                <div class="col-lg-3">
                    <div class="card">
                        <div class="card-body text-center">
                            {% if user.student.profile_picture %}
                            <img alt="Admin" class="rounded-circle p-1 bg-primary" src="{{ user.student.profile_picture.url }}" width="150">
                                {% else %}
                                <img alt="Admin" class="rounded-circle p-1 bg-primary" src="https://bootdey.com/img/Content/avatar/avatar6.png" width="150">
                                    {% endif %}
                                    <div class="mt-3">
                                        <h4>
                                            {{user.first_name}} {{user.last_name}}
                                        </h4>
                                        <p class="text-secondary mb-1">
                                            Gender: {{user.student.gender}}
                                        </p>
                                        <p class="text-secondary mb-1">
                                            Age: {{user.student.age}} years old
                                        </p>
                                        <p class="text-secondary mb-1">
                                            Student ID: {{user.student.student_id}}
                                        </p>
                                        <p class="text-secondary mb-1">
                                            Class stream: {{user.student.form}}{{user.student.stream}}
                                        </p>
                                        <p class="text-secondary mb-1">
                                            Started School on: {{user.student.joined_school_at}}
                                        </p>
                                    </div>
                                </img>
                            </img>
                        </div>
                    </div>
                </div>
                <!-- School term -->
                <div class="col-xl-4 col-md-12">
                    <div class="card overflow-hidden">
                        <div class="card-body">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                    <i class="bi-calendar-event text-primary fs-2 me-3">
                                    </i>
                                    <div>
                                        <h4 class="mb-0">
                                            Term 2
                                        </h4>
                                        <small class="text-muted">
                                            opened on June 12, 2025
                                        </small>
                                    </div>
                                </div>
                                <h5 class="mb-0">
                                    2025/2026
                                </h5>
                            </div>
                        </div>
                    </div>
                    <!-- Registration status -->
                    <div class="card overflow-hidden">
                        <div class="card-body">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                    <i class="bi-check-circle text-primary fs-2 me-3">
                                    </i>
                                    <div>
                                        <h4 class="mb-0">
                                            Term Registration Status
                                        </h4>
                                        {% if user.student %}
                                        <small class="text-muted">
                                            Registered on: {{user.student.updated_at}}
                                        </small>
                                        {% else %}
                                        <small class="text-muted">
                                            Not Registered.
                                        </small>
                                        <a class="icon-link icon-link-hover text-decoration-none" href="{% url 'profile_create' %}">
                                            Click to register
                                            <svg aria-hidden="true" class="bi" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z">
                                                </path>
                                            </svg>
                                        </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- School fees -->
                    <div class="col-xl-12 col-md-6">
                        <div class="card overflow-hidden">
                            <div class="card-body">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center">
                                        <i class="bi-wallet2 text-primary fs-2 me-3">
                                        </i>
                                        <div>
                                            <h4 class="mb-0">
                                                School fees
                                            </h4>
                                            <small class="text-muted">
                                                Fees balance
                                            </small>
                                        </div>
                                    </div>
                                    <h3 class="mb-0">
                                        K18,000
                                    </h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Top 3 best performing students -->
                <div class="col-xl-4 col-md-12">
                    <div class="card shadow-sm border-0 mb-4">
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="bi bi-trophy-fill me-2">
                                </i>
                                Top 3 Performers
                            </h5>
                            <span class="badge bg-light text-primary">
                                2025 Term 2
                            </span>
                        </div>
                        {% if user.student %}
                        <div class="card-body">
                            <ol class="list-group list-group-numbered mb-2">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>
                                            Chisomo Banda
                                        </strong>
                                        <br>
                                            <small class="text-muted">
                                                Average: 92%
                                            </small>
                                        </br>
                                    </div>
                                    <span class="badge bg-success rounded-pill">
                                        <i class="bi bi-star-fill me-1">
                                        </i>
                                        Top
                                    </span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>
                                            Thandiwe Phiri
                                        </strong>
                                        <br>
                                            <small class="text-muted">
                                                Average: 89%
                                            </small>
                                        </br>
                                    </div>
                                    <span class="badge bg-secondary rounded-pill">
                                        <i class="bi bi-star-half me-1">
                                        </i>
                                        Runner-up
                                    </span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center mb-2">
                                    <div>
                                        <strong>
                                            Kondwani Mvula
                                        </strong>
                                        <br>
                                            <small class="text-muted">
                                                Average: 87%
                                            </small>
                                        </br>
                                    </div>
                                    <span class="badge bg-warning text-dark rounded-pill">
                                        <i class="bi bi-lightning-charge-fill me-1">
                                        </i>
                                        3rd
                                    </span>
                                </li>
                                <a class="btn btn-primary" href="#">
                                    See top 10
                                </a>
                            </ol>
                        </div>
                        {% else %}
                        <br>
                            <p style="margin-left: 5px;">
                                Register first
                            </p>
                            {% endif %}
                        </br>
                    </div>
                </div>
            </div>
        </div>
        <div class="card mb-4 mx-3">
            <div class="card-header">
                <i class="fas fa-table me-1">
                </i>
                Subjects Assigned For
                <strong>
                    {{user.first_name}} {{user.last_name}}
                </strong>
            </div>
            {% if user.student %}
            <div class="card-body">
                <table class="table table-bordered" id="datatablesSimple">
                    <thead>
                        <tr>
                            <th>
                                Subject Name
                            </th>
                            <th>
                                Subject Code
                            </th>
                            <th>
                                Assigned Teacher
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for subject in user.student.subject.all %}
                        <tr>
                            <td>
                                {{subject.subject_name}}
                            </td>
                            <td>
                                {{subject.subject_code}}
                            </td>
                            <td>
                                {% for teacher in subject.teacher_set.all %}
                                    {% if teacher.stream1 == user.student.stream or teacher.stream2 == user.student.stream or teacher.stream3 == user.student.stream %}
                                        {{teacher.user.first_name}} {{teacher.user.last_name}}
                                    
                                    {% endif %}

                                    {% empty %}
                                        No teacher assigned
                                    {% endfor %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <br>
                <p style="margin-left: 5px;">
                    No subjects. Register first.
                </p>
                {% endif %}
            </br>
        </div>
    </main>
</div>
